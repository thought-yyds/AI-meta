# 会议监控功能架构说明

## 问题：浏览器最小化后监控功能是否还能工作？

**答案：✅ 可以正常工作！**

## 架构说明

### 系统架构

```
┌─────────────────┐
│   浏览器前端    │  ← 用户界面（可以最小化）
│  (Vue 3)       │
└────────┬────────┘
         │ HTTP API
         ▼
┌─────────────────┐
│  后端服务       │  ← Agent 和工具运行在这里
│  (FastAPI)      │
└────────┬────────┘
         │ MCP 协议
         ▼
┌─────────────────┐
│ WindowsMCP.Net  │  ← 独立的系统级服务
│  (独立进程)     │     直接调用 Windows API
└─────────────────┘
```

### 关键点

1. **Agent 运行在后端**：Agent 和所有工具都在后端 Python 服务中运行，不在浏览器中
2. **WindowsMCP.Net 是独立进程**：通过 MCP 协议与后端通信，直接访问 Windows 系统 API
3. **截图功能不依赖浏览器**：使用 Windows API 直接截取屏幕，与浏览器窗口状态无关

## 功能说明

### 监控屏幕变化 (`monitor_screen_changes`)

- **工作原理**：
  - 后端服务持续调用 WindowsMCP.Net 的 `extract_text_from_screen` 和 `screenshot` 工具
  - 比较前后两次的屏幕内容，检测变化
  - 当检测到变化时，自动保存截图

- **浏览器最小化的影响**：
  - ✅ **无影响**：功能完全在后端运行
  - ✅ **可以正常监控**：即使浏览器最小化，后端服务仍在运行
  - ✅ **可以正常截图**：WindowsMCP.Net 直接访问系统 API，不受浏览器影响

### 捕获幻灯片 (`capture_slide_content`)

- **工作原理**：
  - 调用 WindowsMCP.Net 的 `extract_text_from_screen` 进行 OCR
  - 调用 `screenshot` 保存截图
  - 返回识别出的文字和截图路径

- **浏览器最小化的影响**：
  - ✅ **无影响**：功能完全在后端运行
  - ✅ **可以正常捕获**：直接访问系统屏幕，不受浏览器影响

## 使用建议

### 1. 监控时长设置

由于 HTTP 请求有超时限制，建议：
- `duration` 参数不要设置过长（建议不超过 300 秒/5 分钟）
- 如果需要长时间监控，可以：
  1. 多次调用监控工具（每次监控较短时间）
  2. 或者考虑实现后台任务机制（需要额外开发）

### 2. 浏览器窗口管理

- ✅ **可以最小化浏览器**：不影响监控功能
- ✅ **可以切换到其他应用**：监控会继续工作
- ⚠️ **注意**：如果会议窗口被最小化，截图会捕获当前活动窗口，可能不是会议内容

### 3. 最佳实践

1. **开始监控前**：
   - 确保会议窗口是活动的（或至少可见）
   - 设置合理的监控时长（建议 60-300 秒）

2. **监控过程中**：
   - 可以最小化浏览器，不影响监控
   - 可以切换到其他应用，但注意会议窗口不要被完全遮挡

3. **监控完成后**：
   - 查看捕获的截图和文本
   - 使用其他工具（如 `extract_structured_agenda`）分析内容

## 技术细节

### WindowsMCP.Net 的工作原理

WindowsMCP.Net 是一个独立的 .NET 进程，它：
- 直接调用 Windows API（如 `BitBlt`、`GetWindowText` 等）进行截图和窗口操作
- 不依赖任何浏览器或前端框架
- 可以访问整个屏幕，不受窗口状态限制

### 后端服务的运行方式

- FastAPI 服务运行在独立的 Python 进程中
- 每个 HTTP 请求会创建一个 Agent 实例
- Agent 调用工具时，工具通过 MCP 协议与 WindowsMCP.Net 通信
- 即使 HTTP 请求完成，如果工具内部有长时间运行的任务，也会继续执行

## 常见问题

### Q: 浏览器最小化后，监控会停止吗？
**A:** 不会。监控功能完全在后端运行，浏览器只是用户界面。

### Q: 如果会议窗口也被最小化了，还能捕获到内容吗？
**A:** 可以捕获，但可能捕获的是其他活动窗口的内容。建议保持会议窗口可见。

### Q: 监控会占用很多资源吗？
**A:** 监控会定期（每 interval 秒）进行 OCR 和截图，会消耗一定的 CPU 和内存。建议合理设置 interval（建议 5-10 秒）。

### Q: 可以同时运行多个监控任务吗？
**A:** 理论上可以，但会消耗更多资源。建议一次只运行一个监控任务。

## 总结

✅ **浏览器最小化不影响监控功能**
✅ **所有监控和捕获功能都在后端运行**
✅ **WindowsMCP.Net 直接访问系统 API，不受浏览器影响**

可以放心地最小化浏览器窗口，监控功能会继续正常工作！

